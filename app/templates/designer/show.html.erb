<% content_for :htmx_merge, "defaultSwapStyle" => "innerHTML" %>

<%= render "shared/title", text: "Designer" %>

<section class="bit-page page-designer">
  <header class="bit-header">
    <h1 class="label">
      Designer
      <%= render "shared/popovers/trigger", name: :overview, width: 20, height: 20 %>
    </h1>
  </header>

  <%= scope(:popover_content, name: :overview, label: "Overview").render do %>
    <p>Use the text area to design custom screens for your device using pure HTML/CSS. Changes are applied automatically as you make edits and saved as a screen which you can view via the <%= link_to "Screens", routes.path(:screens) %> page.</p>
  <% end %>

  <div class="designer">
    <figure class="device"
            hx-ext="sse"
            sse-connect="/preview/<%= name %>"
            sse-swap="preview">
      <%= image_tag "loader.svg", alt: "Loader", width: 800, height: 480 %>
    </figure>

    <form action="/designer" method="post" class="form">
      <%= tag.input name: :_csrf_token, type: :hidden, value: csrf_token %>
      <%= tag.input name: "template[name]", type: :hidden, value: name %>
      <%= tag.input name: "template[label]", type: :hidden, value: label %>

      <textarea name="template[content]"
                class="source"
                hx-post="/designer"
                hx-trigger="load, keyup delay:200ms"
                hx-swap="textContent"><%= render :welcome %></textarea>
    </form>
  </div>
</section>
